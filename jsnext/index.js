import axios from"axios";import _regeneratorRuntime from"@babel/runtime/regenerator";import pluralise from"pluralize";import{camel,deserialise,query,serialise}from"kitsu-core";function asyncGeneratorStep(e,t,r,n,a,i,s){try{var o=e[i](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function s(e){asyncGeneratorStep(i,n,a,s,o,"next",e)}function o(e){asyncGeneratorStep(i,n,a,s,o,"throw",e)}s(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function normalizeArray(e,t){for(var r=0,n=e.length-1;n>=0;n--){var a=e[n];"."===a?e.splice(n,1):".."===a?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}axios.defaults.timeout=3e3,axios.defaults.headers.common["Content-Type"]="application/json",axios.defaults.baseURL="http://localhost:7001",axios.interceptors.request.use(function(e){return console.log("fly请求体 --\x3e>>%o",e),e}),axios.interceptors.response.use(function(e){return console.log("fly返回体 --\x3e>>%o",e.data),e},function(e){if(e.response){var t=e.response.data;t&&t.errors&&(e.errors=t.errors)}return e});var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(e){return splitPathRe.exec(e).slice(1)};function resolve(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(e=n+"/"+e,t="/"===n.charAt(0))}return(t?"/":"")+(e=normalizeArray(filter(e.split("/"),function(e){return!!e}),!t).join("/"))||"."}function normalize(e){var t=isAbsolute(e),r="/"===substr(e,-1);return(e=normalizeArray(filter(e.split("/"),function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function isAbsolute(e){return"/"===e.charAt(0)}function join(){return normalize(filter(Array.prototype.slice.call(arguments,0),function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function relative(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=resolve(e).substr(1),t=resolve(t).substr(1);for(var n=r(e.split("/")),a=r(t.split("/")),i=Math.min(n.length,a.length),s=i,o=0;o<i;o++)if(n[o]!==a[o]){s=o;break}var u=[];for(o=s;o<n.length;o++)u.push("..");return(u=u.concat(a.slice(s))).join("/")}var sep="/",delimiter=":";function dirname(e){var t=splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."}function basename(e,t){var r=splitPath(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r}function extname(e){return splitPath(e)[3]}var path={extname:extname,basename:basename,dirname:dirname,sep:sep,delimiter:delimiter,relative:relative,join:join,isAbsolute:isAbsolute,normalize:normalize,resolve:resolve};function filter(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var substr="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)};function baseURL(e){return function(t,r,n){t.axios.defaults.baseURL=e}}function engine(e){return function(t,r,n){t.engine=e}}function config(e){return function(t,r,n){t.axios.defaults=Object.assign(t.axios.defaults,e)}}var API=function(){function e(){_classCallCheck(this,e)}var t,r,n,a,i,s,o,u,c;return _createClass(e,null,[{key:"get",value:(c=_asyncToGenerator(_regeneratorRuntime.mark(function e(){var t,r,n,a,i,s,o,u,c=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1&&void 0!==c[1]?c[1]:{},e.prev=2,n=t.id,a=t.relationship,i=_objectWithoutProperties(t,["id","relationship"]),s=this.plural(this.resCase(this.pathname)),n&&(s+="/".concat(n)),a&&(s+="/".concat(this.resCase(a))),e.next=9,this.axios.get(s,{params:i,paramsSerializer:function(e){return query(e)},headers:Object.assign(this.headers,r)});case 9:return o=e.sent,u=o.data,e.abrupt("return",deserialise(u));case 14:e.prev=14,e.t0=e.catch(2),this.onError(e.t0);case 17:case"end":return e.stop()}},e,this,[[2,14]])})),function(){return c.apply(this,arguments)})},{key:"patch",value:(u=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o,u=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},e.prev=1,n=this.pathname,e.next=5,serialise.apply(this,[n,t,"PUT"]);case 5:return a=e.sent,i=this.plural(this.resCase(n))+"/"+t.id,e.next=9,this.axios.put(i,a,{headers:Object.assign(this.headers,r)});case 9:return s=e.sent,o=s.data,e.abrupt("return",o);case 14:e.prev=14,e.t0=e.catch(1),this.onError(e.t0);case 17:case"end":return e.stop()}},e,this,[[1,14]])})),function(e){return u.apply(this,arguments)})},{key:"delete",value:(o=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},e.prev=1,n=this.pathname,a=this.plural(this.resCase(n))+"/"+t,e.t0=this.axios,e.t1=a,e.next=8,serialise.apply(this,[n,{id:t},"DELETE"]);case 8:return e.t2=e.sent,e.t3=Object.assign(this.headers,r),e.t4={data:e.t2,headers:e.t3},e.next=13,e.t0.delete.call(e.t0,e.t1,e.t4);case 13:return i=e.sent,s=i.data,e.abrupt("return",s);case 18:e.prev=18,e.t5=e.catch(1),this.onError(e.t5);case 21:case"end":return e.stop()}},e,this,[[1,18]])})),function(e){return o.apply(this,arguments)})},{key:"self",value:(s=_asyncToGenerator(_regeneratorRuntime.mark(function e(){var t,r,n,a=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1&&void 0!==a[1]?a[1]:{},e.prev=2,e.next=5,this.get("users",Object.assign({filter:{self:!0}},t),r);case 5:return n=e.sent,e.abrupt("return",n.data[0]);case 9:e.prev=9,e.t0=e.catch(2),this.onError(e.t0);case 12:case"end":return e.stop()}},e,this,[[2,9]])})),function(){return s.apply(this,arguments)})},{key:"post",value:(i=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a,i,s,o=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},e.prev=1,n=this.pathname,a=this.plural(this.resCase(n)),e.t0=this.axios,e.t1=a,e.next=8,serialise.apply(this,[n,t]);case 8:return e.t2=e.sent,e.t3={headers:Object.assign(this.headers,r)},e.next=12,e.t0.post.call(e.t0,e.t1,e.t2,e.t3);case 12:return i=e.sent,s=i.data,e.abrupt("return",s);case 17:e.prev=17,e.t4=e.catch(1),this.onError(e.t4);case 20:case"end":return e.stop()}},e,this,[[1,17]])})),function(e){return i.apply(this,arguments)})},{key:"setHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.headers=Object.assign(this.headers,e)}},{key:"all",value:(a=_asyncToGenerator(_regeneratorRuntime.mark(function e(){var t,r,n=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",this.get(t,r));case 3:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getById",value:(n=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n,a=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.get(_objectSpread({id:t},r),n));case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"update",value:(r=_asyncToGenerator(_regeneratorRuntime.mark(function e(){var t,r,n=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",this.patch(t,r));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"create",value:(t=_asyncToGenerator(_regeneratorRuntime.mark(function e(){var t,r,n=arguments;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",this.post(t,r));case 3:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"onError",value:function(e){console.log(this.pathname+" on error:",e)}},{key:"model",get:function(){return this.prototype.constructor.name.toLowerCase()}},{key:"pathname",get:function(){return path.join(this.prefix,this.model)}}]),e}();API.axios=axios,API.plural=pluralise,API.headers={},API.config={},API.camel=camel,API.resCase=camel,API.prefix="";export default API;export{API,baseURL,engine,config};
